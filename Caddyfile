jetdail.fr {
    reverse_proxy codeserver-main:8080

    # Log to stdout so Docker captures it (avoid file perms in container)
    log {
        output stdout
        format console
        level INFO
    }
}

dev.jetdail.fr {
    reverse_proxy codeserver-main:5173 {
        # Active health checks (optional; only useful if the dev server actually runs)
        health_uri /
        health_interval 15s
        health_timeout 5s

        # Usually not needed; Caddy sets sane forwards.
        # header_up Host {upstream_hostport}
        # (Remove X-Forwarded-Proto; Caddy forwards it by default)
    }

    # Custom error page when upstream is down
    handle_errors {
        @5xx expression `{http.error.status_code} >= 500`
        header @5xx Content-Type "text/html; charset=utf-8"
        respond @5xx `<!doctype html>
<html>
  <head><meta charset="utf-8"><title>VueVN Dev Server</title></head>
  <body>
    <h2>ğŸš€ VueVN Dev Server</h2>
    <p>Dev server not running.</p>
    <p>Start with: <code>npm run dev sample</code> in code-server</p>
    <p>Then refresh this page.</p>
  </body>
</html>` 503
    }
}

